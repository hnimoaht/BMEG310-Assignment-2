---
title: "A2-310"
author: "Sarah Dumont"
date: "2025-10-16"
output: pdf_document
---

```{r}
ovarian.dataset <- read.delim("ovarian.data", sep=",", header = FALSE)
features <- c("perimeter", "area", "smoothness", "symmetry", "concavity", paste("protein", seq(1, 25), sep=""))
names(ovarian.dataset) <- c("cell_id", "diagnosis", features) # paste0(features,"_mean"), paste0(features,"_se"), paste0(features,"_worst"))

View(ovarian.dataset)
```

```{r}

ovarian_numeric <- ovarian.dataset[, -c(1, 2)]

ovarian_scaled <- scale(ovarian_numeric)

pca_result <- prcomp(ovarian_scaled, center = TRUE, scale. = TRUE)

summary_pca <- summary(pca_result)
prop_var <- summary_pca$importance[2, ]  
prop_var[1]  


```

```{r}
prop_var[1]  

```

```{r}
cum_var <- cumsum(prop_var)
num_PCs_90 <- which(cum_var >= 0.9)[1]
num_PCs_90 
```

```{r}

library(factoextra)

cell_class <- ovarian.dataset$diagnosis

fviz_pca_ind(
  pca_result,
  geom = "point",
  habillage = cell_class,       # color by class
  addEllipses = TRUE,           # 95% confidence ellipses
  palette = c("#0072B2", "#8A2BE2"), # blue/purple
  title = "PCA: First Two Principal Components"
)
```



```{r}
concav <- ovarian.dataset$concavity

plot(area, concav,
     main = "Scatterplot of Area vs Concavity",
     xlab = "Area",
     ylab = "Concavity",
     pch = 20,
     col = ifelse(cell_class == "M", "#8A2BE2", "#0072B2"))  # malignant = purple, benign = blue

legend("topright", legend = c("Benign", "Malignant"),
       col = c("#0072B2", "#8A2BE2"), pch = 20)
```

```{r}
boxplot(area ~ diagnosis, data=ovarian.dataset,
        main="Boxplot of Area by Diagnosis", col=c("blue","red"),
        xlab="Diagnosis", ylab="Area")
boxplot(concav ~ diagnosis, data=ovarian.dataset,
        main="Boxplot of Concavity by Diagnosis", col=c("blue","red"),
        xlab="Diagnosis", ylab="Concavity")
```

```{r}
boxplot(pca_result$x,
        main = "Distribution of Principal Components",
        xlab = "",
        ylab = "PC Scores",
        col = "#E7B800",  # yellow-orange
        las = 2,           # vertical PC labels
        border = "gray40")
```



```{r}
#library(factoextra)
#library(cluster)

# Perform k-means

km <- kmeans(ovarian_scaled, centers = 2, nstart = 25)

ovarian_scaled_df <- as.data.frame(ovarian_scaled)
ovarian_scaled_df$Cluster <- km$cluster
ovarian_scaled_df$Diagnosis <- ovarian.dataset$diagnosis

cluster_labels <- ifelse(km$cluster == 1, "M", "B")

table(True = ovarian_scaled_df$Diagnosis, Cluster = cluster_labels)

fviz_cluster(km, data = ovarian_scaled)
``` 
```{r}
table(ovarian.dataset$diagnosis)
prop.table(table(ovarian.dataset$diagnosis)) * 100

```


```{r}

for (i in 1:10) {
  set.seed(Sys.time() + i)  # different random seed each run
kmQ2 <- kmeans(ovarian_scaled, centers = 2, nstart = 1)
ovarian_scaled_df <- as.data.frame(ovarian_scaled)
ovarian_scaled_df$Cluster <- kmQ2$cluster
ovarian_scaled_df$Diagnosis <- ovarian.dataset$diagnosis

cluster_labels <- ifelse(kmQ2$cluster == 1, "M", "B")
  # Compute accuracy
accuracy <- mean(cluster_labels == ovarian_scaled_df$Diagnosis)

# If accuracy < 10%, flip the labels
if (accuracy < 0.1) {
  cluster_labels <- ifelse(kmQ2$cluster == 1, "B", "M")
}

table(True = ovarian_scaled_df$Diagnosis, Cluster = cluster_labels)

  # Print iteration number


  cat("\n--- K-means Run", i, "---\n")
  
  # Show confusion table
  print(table(True = ovarian_scaled_df$Diagnosis, Cluster = cluster_labels))
}



  
```
```{r}
store <- NULL  # initialize before the loop

for (i in 1:5000) {
set.seed(Sys.time() + i) 
  kmQ2 <- kmeans(ovarian_scaled, centers = 2, nstart = 1)
  
  ovarian_scaled_df <- as.data.frame(ovarian_scaled)
  ovarian_scaled_df$Cluster <- kmQ2$cluster       
  ovarian_scaled_df$Diagnosis <- ovarian.dataset$diagnosis
  
  cluster_labels <- ifelse(kmQ2$cluster == 1, "M", "B")
  
  if(sum(cluster_labels == "M" & ovarian_scaled_df$Diagnosis == "M") +
   sum(cluster_labels == "B" & ovarian_scaled_df$Diagnosis == "B") <
   sum(cluster_labels == "M" & ovarian_scaled_df$Diagnosis == "B") +
   sum(cluster_labels == "B" & ovarian_scaled_df$Diagnosis == "M")) {
  cluster_labels <- ifelse(kmQ2$cluster == 1, "B", "M")  # flip
}

  if (!is.null(store) && !identical(store, cluster_labels)) {
    cat("\n--- K-means Run", i, " (changed) ---\n")
    print(table(True = ovarian_scaled_df$Diagnosis, Cluster = cluster_labels))
  }
  
  # Update store
  store <- cluster_labels
}


```


```{r}

pca_top_5 <- pca_result$x[, 1:5]

km_pca <- kmeans(pca_top_5, centers = 2, nstart = 25)

ovarian_pca_df <- as.data.frame(pca_top_5)
ovarian_pca_df$Cluster <- km_pca$cluster
ovarian_pca_df$Diagnosis <- ovarian.dataset$diagnosis

cluster_labels_pca <- ifelse(km_pca$cluster == 1, "B", "M")

table(True = ovarian_pca_df$Diagnosis, Cluster = cluster_labels_pca)
# 

```

```{r}

# Extract top 5 PCs from your PCA result
pca_top_5 <- as.data.frame(pca_result$x[, 1:5])

pca_top_5$Diagnosis <- ovarian.dataset$diagnosis

for (i in 1:10) {
  set.seed(i) 
  
  kmQ2 <- kmeans(pca_top_5[, 1:5], centers = 2, nstart = 1)
  
  ovarian_scaled_df <- pca_top_5
  ovarian_scaled_df$Cluster <- kmQ2$cluster
  
  cluster_labels <- ifelse(kmQ2$cluster == 1, "B", "M")
 
  cat("\nK-means Run", i, "\n")
  print(table(True = ovarian_scaled_df$Diagnosis, Cluster = cluster_labels))
}

```

```{r}
ovarian.dataset$diagnosis <- factor(ovarian.dataset$diagnosis, levels = c("B", "M"))

ovarian.dataset.train <- ovarian.dataset[sample(nrow(ovarian.dataset))[1:(nrow(ovarian.dataset)/2)],]
ovarian.dataset.test <- ovarian.dataset[sample(nrow(ovarian.dataset))[(nrow(ovarian.dataset)/2):(nrow(ovarian.dataset))],]

```

```{r}

# Fit logistic regression with warning handler
model1 <- tryCatch({
  glm(diagnosis ~ ., data = ovarian.dataset.train, family = binomial)
}, warning = function(w) {
  suppressWarnings(glm(diagnosis ~ ., data = ovarian.dataset.train, family = binomial))
}, error = function(e) {
  stop("❌ Logistic regression failed: ", e$message)
})

# Predict probabilities on the test set
test_probs <- predict(model1, ovarian.dataset.test, type = "response")

# Convert probabilities to labels (threshold = 0.5)
test_pred <- ifelse(test_probs > 0.5, "M", "B")

# Compare with true labels
table(True = ovarian.dataset.test$diagnosis, Predicted = test_pred)

```


```{r}
pca_top_5$diagnosis <- ovarian.dataset$diagnosis 
pca_top_5.train <- pca_top_5[sample(nrow(pca_top_5))[1:(nrow(pca_top_5)/2)],]
pca_top_5.test <- pca_top_5[sample(nrow(pca_top_5))[(nrow(pca_top_5)/2):(nrow(pca_top_5))],]

model2 <- tryCatch({
  glm(diagnosis ~ ., data = pca_top_5.train, family = binomial)
}, warning = function(w) {
  suppressWarnings(glm(diagnosis ~ ., data = pca_top_5.train, family = binomial))
}, error = function(e) {
  stop("❌ Logistic regression failed: ", e$message)
})

test_probs <- predict(model2, pca_top_5.test, type = "response")

test_pred <- ifelse(test_probs > 0.5, "M", "B")

table(True = pca_top_5.test$diagnosis, Predicted = test_pred)
```


```{r}
#library(ROCR)
pred.prob <- predict(model1, ovarian.dataset, type="response")
predict <- prediction(pred.prob, ovarian.dataset$diagnosis, label.ordering=c("B","M"))
perform <- performance(predict,"tpr","fpr")
plot(perform,colorize=TRUE)


```


```{r}
library(MASS)
model_new <- lda(diagnosis ~ ., data = ovarian.dataset.train)
model_new <- predict(model_new, ovarian.dataset.test)$class
table(True = ovarian.dataset.test$diagnosis, Predicted = model_new)


pca_top_5.train <- pca_top_5.train[, !names(pca_top_5.train) %in% c("Diagnosis")]
pca_top_5.test  <- pca_top_5.test[, !names(pca_top_5.test) %in% c("Diagnosis")]
model_new_pca <- lda(diagnosis ~ ., data = pca_top_5.train)
lda_pred <- predict(model_new_pca, pca_top_5.test)$class
table(True = pca_top_5.test$diagnosis, Predicted = lda_pred)

```

```{r}


```

